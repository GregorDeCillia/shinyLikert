---
title: "Examples"
author: "Gregor de Cillia"
date: "January 18, 2016"
output: 
  html_document: 
    highlight: textmate
    theme: united
    toc: yes
runtime: shiny 
---

# Import

To create a shiny widget the data is assumed to be of class `likertData`, which basically consists of three data frames.

```{r, results='hide', message=FALSE}
  library('knitr')
  #library(shinyLikert)      # load the package from installed library
  require( 'devtools' )
  devtools::load_all( ".." ) # load the package from source
  testData2 = createTestData( participants = 100, 
                              questions    = 10, 
                              input, 
                              output )

```

The structure of the data is as follows

```{r}
  summary( testData2 )
```

* The first data frame `likert_data` consists of answers of 100 participants to 10 questions.
* The second data frame allows it to classify the participants. In this case, the default method of `createTestData` gives "country" and "gender" as factors.
* `question_factors` consists of factors, that let you classify the questions into groups. In this case, each question has been marked "easy" or "hard". Therefore, we get a factorial variable with 10 observations.

# Simple usuage

```{r}
  fluidPage( 
    renderShinyLikert( "abc", testData2 )  
  )
```


The main function can be used like this

```{r djfdfd,  eval=FALSE}
  renderShinyLikert( 
        id, dataset , dropdown_factor )
```

It takes a unique `id` as input. The dataset is assumed to be of class `likertData`. 

## In Shiny Markdown documents

It's output is a list contining the plot and the control element. They can be used like here

```{r, eval = FALSE}
  rendered2 = renderShinyLikert( "ID 1",
        testData2,
        dropdown = "country" )
  rendered2$selector
  rendered2$plot
  dataTableOutput("ID 1.factorTable")

```

wich produces the following output.

```{r, echo=FALSE}
  rendered2 = renderShinyLikert( "ID 1",
        testData2 ,
        dropdown = "country" )
  rendered2$selector
  rendered2$plot
  dataTableOutput( "ID 1.factorTable" )
```

We used the dataset `testData2` here. This data consists of three data frames.

```{r}
  names( testData2 )
```

The first data frame `likert_data` consists of the likert items. The row names are the participant IDs and the column names are the questions of the of the survey.

```{r}
  kable( head( testData2$likert_data[,1:6] ) )
```

The second data frame `row_factors` can be used to classify the participants.

```{r}
  kable( head( testData2$row_factors ) )
```

The third data frame `column_factors` can be used to classify the questions.

```{r}
  kable( head( testData2$column_factors ) )
```

The factors to be used in `dropdown` can be either row factors or column factors called by name. The dataset is filtered according to those factors prior to plotting. If you want to filter by question, just add another column to `testData2$column_factors`

```{r}
  testData2$column_factors = cbind( testData2$column_factors,
                                    question = paste( "Question", 
                                                      1:10 )
  )

  rendered2.1 = renderShinyLikert( "ID 1.1",
                                   testData2,
                                   dropdown = c("difficulty",
                                                "question") )
  rendered2.1$selector
  rendered2.1$plot
  
```



## Ui/Server setup

To use this function in a ui/server setup, you can use the following syntax

```{r}

shinyApp(
    ui= fluidPage(
        uiOutput("selector"),
        uiOutput( "plot" )
      ),
    server = function(input,output,session){
      rendered = renderShinyLikert( 
        "ID 2", testData2 , input, output, 
        dropdown = "gender" )
      output$plot = rendered$plot
      output$selector = rendered$selector
    }
  )
  
```

# Input options

## Several dropdown inputs

`output$selector` is the inputpanel which lets you select the gender in this case. To add more inputs, from them together in a list.

```{r}
    rendered3 = renderShinyLikert( "ID 3",
        testData2,
        dropdown = c( "country", "difficulty" )
    )
  rendered3$selector
  rendered3$plot
```

You can also use `column_factors` exactly as above.

```{r}
  fluidPage(
    renderShinyLikert( "ID 4",
        testData2,
        dropdown = c( "difficulty" )
    )
  )
```

## Height


To control the height of the plot, use the option `height = c( height_min, height_max )`

```{r}
    fluidPage( 
      renderShinyLikert( "ID 5",
        testData2, 
        dropdown = c( "gender", "country" ),
        height = c( 300, 600 )
      ) 
    )
```

You can also copy the plot above, like so


```{r}
  plotOutput( "ID 5.plot" )
```

## Responselevels

To get a custom order for the responses, use the responselevels parameter

```{r}
    fluidPage( 
      renderShinyLikert( "ID 6",
        testData2,
        dropdown = "gender",
        response_levels = c( "Strongly agree", "Agree", "Neutral" )
      ) 
    )
```

## Pass arguments to `HH::likert`

You can also pass arguments down to `HH::likert`

```{r}
    fluidPage( 
      renderShinyLikert( "ID 7",
        testData2,
        dropdown = "country",
        main = "custom_title",
        horizontal = FALSE,
        as.percent = TRUE,
        positive.order = TRUE
      ) 
    )
```

You can also use the names of `column_factors` for the dropdown argument.

```{r}
    fluidPage( 
      renderShinyLikert( "ID faf",
        testData2,
        dropdown = "difficulty"      ) 
    )
```

## split_factors

For factror analysis, you can also use the `split_factors` argument.

```{r}
    fluidPage( 
      renderShinyLikert( "ID 7.5",
        testData2,
        split    = c( "difficulty", "gender", "country" ),
        positive.order = TRUE   # ???
      ) 
    )
```

```{r}
    fluidPage( 
      renderShinyLikert( "ID 8",
        testData2 ,  
        dropdown = "country",
        split    = "difficulty"
      ) 
    )
```

```{r, eval = FALSE }
    fluidPage( 
      renderShinyLikert( "ID 9",
        testData2 ,  
        dropdown = "question",
        split    = "country"
      ) 
    )
```

# Grouping data with the likert package

```{r}
    fluidPage( 
      renderShinyLikert( "ID 10",
        testData2,
        height  = c(500,800),
        dropdown = c("gender","difficulty"),
        group = "country"
      ) 
    )
```

```{r}
    fluidPage( 
      renderShinyLikert( "ID 11",
        testData2,
        height  = c(500,800),
        dropdown = c("country","difficulty"),
        group = "gender",
        grouping = "HH"
      ) 
    )
```

